general:
    branches:
        only:
            - developing
        ignore:
            - master
            - /hotfix-.*/
            - /release-.*/
            - /support-.*/
            - /dev-.*/

machine:
    timezone:
        Europe/Berlin

    environment:
        GIT_AUTHOR_NAME: CircleCI
        GIT_AUTHOR_EMAIL: info@lightjason.org
        GIT_COMMITTER_NAME: CircleCI
        GIT_COMMITTER_EMAIL: info@lightjason.org
        GIT_COMMIT_MESSAGE: $(git log --format=oneline -n 1 $CIRCLE_SHA1)

    java:
        version: oraclejdk8        

dependencies:
    pre:
        # see release version https://github.com/spf13/hugo/releases
        - wget -O hugo.deb https://github.com/spf13/hugo/releases/download/v0.18/hugo_0.18-64bit.deb
        - sudo dpkg -i hugo.deb
        # see release version https://github.com/yui/yuicompressor/releases
        - wget -O yuicompressor.jar https://github.com/yui/yuicompressor/releases/download/v2.4.8/yuicompressor-2.4.8.jar
  

test:
    override:
        - hugo
        - find public -type f -name "*.css" -exec java -jar yuicompressor.jar -o \{\} \{\} \; 
        - find public -type f -name "*.js" -exec java -jar yuicompressor.jar -o \{\} \{\} \; 
        - mv -f public /tmp
        - git push origin :master || true
        - git brach -D master || true       
        - git checkout --orphan master
        - rm -Rf *
        - mv -f /tmp/public/* .
        - echo -e 'general:\n    branches:\n        ignore:\n            - master\n' > circle.yml
        - echo -e '*.*\n!.gitignore\n!circle.yml\n!*.html\n!*.xml\n!*.css\n!*.js\n!*.json\n!*.bib\n!*.zip\n!*.png\n!*.gif\n!*.pdf\n!*.svg\n!*.txt\n' > .gitignore
        - echo -e '# LightJason\n\nCurrent website of the [LightJason](http://lightjason.org) project. Last update with _${GIT_COMMIT_MESSAGE}_' > readme.md
        - git add --all .
        - git commit -m "webpage update ${GIT_COMMIT_MESSAGE}"
        - git push origin master
